<?xml version="1.0" encoding="UTF-8"?>

<project name="system-common" default="main" basedir=".">
    
    <target name="clean">
        <delete dir="${basedir}/${release.dir}" />
    </target>
    
    <target name="before">
        <mkdir dir="${basedir}/${release.dir}" />
    </target>
    
    <target name="main" depends="clean,before,build-abc,build-swc,after">
        
    </target>
    
    <target name="build-abc">
        
        <java
            dir="${basedir}"
            jar="${ASC}"
            fork="true"
            failonerror="true"
        >
            <arg line="-AS3 -strict -optimize"/>
            <arg line="-config API::REDTAMARIN=true -config API::FLASH=false"/>
            <arg line="-import ${builtin} -import ${toplevel} src/common.as"/>
        </java>
        
        <move file="${basedir}/src/common.abc" todir="${basedir}/${release.dir}" />
        
    </target>
    
    <target name="build-swc">
        <compc
            output="${basedir}/${release.dir}/common.swc"
            target-player="${local.flashplayerversion}"
        >
            <load-config filename="${FLEX_HOME}/frameworks/flex-config.xml"/>
            <load-config filename="${basedir}/build/config.xml"/>
            <strict>true</strict>
            <optimize>true</optimize>
            <warnings>true</warnings>
            <verbose-stacktraces>false</verbose-stacktraces>
            <compute-digest>false</compute-digest>
            <!--
            <library-path dir="${basedir}/${project.lib-swc}/" append="true">
               <include name="core.swc"/>
            </library-path>
             -->
            <source-path path-element="${basedir}/${project.src}" />
            <include-sources dir="${basedir}/${project.src}/system">
                <include name="Library.as"/>
                
                <include name="hack.as"/>
                <include name="optimized.as"/>
                <include name="standard.as"/>
                <include name="experimental.as"/>
                
                <include name="Cloneable.as"/>
                <include name="Comparable.as"/>
                <include name="Comparator.as"/>
                <include name="Equatable.as"/>
                <include name="Evaluable.as"/>
                <include name="Formattable.as"/>
                <include name="Serializable.as"/>
                <include name="Serializer.as"/>
                <include name="Sortable.as"/>
                
            </include-sources>
            <metadata date="${TODAY}" title="${project.name}">
                <publisher name="${project.publisher}" />
                <creator name="${project.creator1}" />
                <creator name="${project.creator2}" />
            </metadata>
        </compc>
    </target>
    
    <target name="after">
        
    </target>
    
</project>