<project>

    <!--
    see asc.txt
     -->
    <macrodef name="asc-lib">
        <attribute name="name"/>
        <attribute name="source"/>
        <attribute name="dir"/>
        <attribute name="localdir"/>
        
        <sequential>
            
            <fileset id="files" dir="@{dir}" includes="**/*.as" />
            <pathconvert property="includes" pathsep='";${line.separator}include "' refid="files">
                <chainedmapper>
                    <globmapper from="@{dir}/*" to="@{localdir}/*"/>
                </chainedmapper>
            </pathconvert>
            
            <concat destfile="@{source}.as">include "${includes}";${line.separator}</concat>
            
            <!--
            <exec
                dir="${basedir}"
                executable="java"
                failonerror="true"
            >
                <arg line="-jar ${FLEX_HOME}/lib/asc.jar -AS3 -import build/builtin.abc empty.as"/>
            </exec>
            -->
            
            <java
                dir="${basedir}"
                jar="${FLEX_HOME}/lib/asc.jar"
                fork="true"
                failonerror="true"
            >
                <arg line="-AS3 -strict -optimize -import build/builtin.abc @{source}.as"/>
            </java>
            
            <move file="@{source}.abc" tofile="@{name}.abc"/>
        </sequential>
    
    </macrodef>

</project>
